generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               String          @id @default(cuid())
  username         String          @unique
  password         String
  name             String
  role             String          @default("STUDENT")
  email            String?
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  twoFactorEnabled Boolean         @default(false)
  twoFactorSecret  String?
  backupCodes      String?
  lastLogin        DateTime?
  adminProfile     AdminProfile?
  facultyProfile   FacultyProfile?
  forumPosts       ForumPost[]
  forumReplies     ForumReply[]
  receivedMessages Message[]       @relation("ReceivedMessages")
  sentMessages     Message[]       @relation("SentMessages")
  notifications    Notification[]
  parentProfile    ParentProfile?
  securityAudits   SecurityAudit[]
  profile          StudentProfile?
}

model StudentProfile {
  id                    String                 @id @default(cuid())
  userId                String                 @unique
  regNo                 String                 @unique
  applicationNo         String?                @unique
  program               String
  school                String
  batch                 String
  cgpa                  Float                  @default(0.0)
  photoUrl              String?
  proctorId             String?
  dob                   DateTime?
  bloodGroup            String?
  mobile                String?
  aadharNo              String?
  nativePlace           String?
  nationality           String?
  apaarId               String?
  emergencyName         String?
  emergencyPhone        String?
  bankAccount           String?
  bankIfsc              String?
  joiningDate           DateTime?
  abcId                 String?
  hostelBlock           String?
  hostelRoom            String?
  hostelMess            String?
  biometricId           String?
  achievements          Achievement[]
  activityPoints        ActivityPoint[]
  assignmentSubmissions AssignmentSubmission[]
  attendance            Attendance[]
  attendanceLogs        AttendanceLog[]
  biometricReports      BiometricReport[]
  bookIssues            BookIssue[]
  bookReservations      BookReservation[]
  clubMemberships       ClubMembership[]
  counsellingRecords    CounsellingRecord[]
  courseRegistrations   CourseRegistration[]
  digitalCredentials    DigitalCredential[]
  examApplications      ExamApplication[]
  feedbackResponses     FeedbackResponse[]
  gradeHistories        GradeHistory[]
  hostelAdmissions      HostelAdmission[]
  hostelConsentForms    HostelConsentForm[]
  hostelMaintenance     HostelMaintenance[]
  leaves                LeaveRequest[]
  libraryDues           LibraryDue[]
  marks                 Marks[]
  meetings              Meeting[]
  parentProfiles        ParentProfile[]
  payments              Payment[]
  permissionLetters     PermissionLetter[]
  placementApplications PlacementApplication[]
  migrations            ProgrammeMigration[]
  reevaluationRequests  ReevaluationRequest[]
  researchProfile       ResearchProfile?
  scholarships          Scholarship[]
  seatAllocations       SeatAllocation[]
  serviceRequests       ServiceRequest[]
  proctor               FacultyProfile?        @relation(fields: [proctorId], references: [id])
  user                  User                   @relation(fields: [userId], references: [id])
  thesisSubmission      ThesisSubmission?
  timeTable             TimeTable[]
}

model FacultyProfile {
  id                    String                 @id @default(cuid())
  userId                String                 @unique
  empId                 String                 @unique
  designation           String
  school                String
  mobile                String
  cabin                 String
  photoUrl              String?
  dob                   DateTime?
  bloodGroup            String?
  apaarId               String?
  emergencyName         String?
  emergencyPhone        String?
  joiningDate           DateTime?
  assignmentSubmissions AssignmentSubmission[]
  attendanceLogs        AttendanceLog[]
  counsellingRecords    CounsellingRecord[]
  courses               Course[]
  leaves                FacultyLeave[]
  user                  User                   @relation(fields: [userId], references: [id])
  meetings              Meeting[]
  payrolls              Payroll[]
  supervisedScholars    ResearchProfile[]      @relation("Supervisor")
  proctees              StudentProfile[]
}

model ParentProfile {
  id             String               @id @default(cuid())
  userId         String               @unique
  studentId      String?
  mobile         String?
  emergencyName  String?
  emergencyPhone String?
  announcements  ParentAnnouncement[]
  student        StudentProfile?      @relation(fields: [studentId], references: [id])
  user           User                 @relation(fields: [userId], references: [id])
}

model AdminProfile {
  id     String @id @default(cuid())
  userId String @unique
  level  Int    @default(1)
  user   User   @relation(fields: [userId], references: [id])
}

model Course {
  id             String               @id @default(cuid())
  code           String               @unique
  title          String
  credits        Int
  type           String
  slot           String?
  venue          String?
  category       String?
  syllabusUrl    String?
  facultyId      String?
  assignments    Assignment[]
  attendance     Attendance[]
  attendanceLogs AttendanceLog[]
  faculty        FacultyProfile?      @relation(fields: [facultyId], references: [id])
  announcements  CourseAnnouncement[]
  materials      CourseMaterial[]
  registrations  CourseRegistration[]
  examSchedules  ExamSchedule[]
  forumPosts     ForumPost[]
  marks          Marks[]
  timeTable      TimeTable[]
}

model CourseRegistration {
  id        String         @id @default(cuid())
  studentId String
  courseId  String
  status    String         @default("REGISTERED")
  sem       String?
  year      String?
  createdAt DateTime       @default(now())
  course    Course         @relation(fields: [courseId], references: [id])
  student   StudentProfile @relation(fields: [studentId], references: [id])

  @@unique([studentId, courseId])
}

model CourseMaterial {
  id        String   @id @default(cuid())
  courseId  String
  title     String
  type      String
  url       String
  createdAt DateTime @default(now())
  course    Course   @relation(fields: [courseId], references: [id])
}

model Attendance {
  id              String         @id @default(cuid())
  studentId       String
  courseId        String
  attendedClasses Int
  totalClasses    Int
  percentage      Float
  updatedAt       DateTime       @updatedAt
  course          Course         @relation(fields: [courseId], references: [id])
  student         StudentProfile @relation(fields: [studentId], references: [id])

  @@unique([studentId, courseId])
}

model AttendanceLog {
  id        String         @id @default(cuid())
  studentId String
  courseId  String
  facultyId String
  date      DateTime
  status    String
  slot      String?
  createdAt DateTime       @default(now())
  faculty   FacultyProfile @relation(fields: [facultyId], references: [id])
  course    Course         @relation(fields: [courseId], references: [id])
  student   StudentProfile @relation(fields: [studentId], references: [id])
}

model Marks {
  id           String               @id @default(cuid())
  studentId    String
  courseId     String
  cat1         Float?
  cat2         Float?
  fat          Float?
  da1          Float?
  da2          Float?
  quiz         Float?
  pbl          Float?
  qcm          Float?
  total        Float?
  grade        String?
  isArrear     Boolean              @default(false)
  isDebarred   Boolean              @default(false)
  attendance   Float?
  updatedAt    DateTime             @updatedAt
  course       Course               @relation(fields: [courseId], references: [id])
  student      StudentProfile       @relation(fields: [studentId], references: [id])
  reevaluation ReevaluationRequest?

  @@unique([studentId, courseId])
}

model GradeHistory {
  id          String         @id @default(cuid())
  studentId   String
  semester    String
  courseCode  String
  courseTitle String
  credits     Int
  grade       String
  gradePoint  Int
  result      String         @default("PASS")
  createdAt   DateTime       @default(now())
  student     StudentProfile @relation(fields: [studentId], references: [id])
}

model ReevaluationRequest {
  id          String         @id @default(cuid())
  marksId     String         @unique
  studentId   String
  type        String         @default("SEE")
  status      String         @default("PENDING")
  appliedAt   DateTime       @default(now())
  completedAt DateTime?
  feePaid     Boolean        @default(false)
  student     StudentProfile @relation(fields: [studentId], references: [id])
  marks       Marks          @relation(fields: [marksId], references: [id])
}

model AcademicEvent {
  id          String    @id @default(cuid())
  title       String
  description String?
  date        DateTime
  endDate     DateTime?
  type        String    @default("EVENT")
  location    String?
  createdAt   DateTime  @default(now())
}

model SemesterMilestone {
  id          String   @id @default(cuid())
  title       String
  description String?
  date        DateTime
  type        String   @default("EXAM")
  sem         String?
  createdAt   DateTime @default(now())
}

model TimeTable {
  id        String         @id @default(cuid())
  studentId String
  courseId  String
  day       String
  startTime String
  endTime   String
  venue     String?
  slot      String
  course    Course         @relation(fields: [courseId], references: [id])
  student   StudentProfile @relation(fields: [studentId], references: [id])
}

model Payment {
  id          String         @id @default(cuid())
  studentId   String
  amount      Float
  description String
  type        String         @default("TUITION")
  status      String         @default("PENDING")
  dueDate     DateTime
  paidDate    DateTime?
  receiptUrl  String?
  createdAt   DateTime       @default(now())
  student     StudentProfile @relation(fields: [studentId], references: [id])
}

model Scholarship {
  id          String         @id @default(cuid())
  studentId   String
  name        String
  amount      Float
  status      String         @default("APPLIED")
  type        String
  appliedDate DateTime       @default(now())
  student     StudentProfile @relation(fields: [studentId], references: [id])
}

model FeeStructure {
  id           String @id @default(cuid())
  name         String
  amount       Float
  category     String
  academicYear String
}

model LeaveRequest {
  id             String         @id @default(cuid())
  studentId      String
  type           String
  category       String?
  fromDate       DateTime
  toDate         DateTime
  reason         String
  status         String         @default("PENDING")
  leaveApproval  String?
  proctorComment String?
  createdAt      DateTime       @default(now())
  student        StudentProfile @relation(fields: [studentId], references: [id])
}

model PermissionLetter {
  id        String         @id @default(cuid())
  studentId String
  title     String
  type      String
  url       String
  status    String         @default("VALID")
  createdAt DateTime       @default(now())
  student   StudentProfile @relation(fields: [studentId], references: [id])
}

model ServiceRequest {
  id             String         @id @default(cuid())
  studentId      String
  type           String
  status         String         @default("PENDING")
  requestDate    DateTime       @default(now())
  completionDate DateTime?
  documentUrl    String?
  student        StudentProfile @relation(fields: [studentId], references: [id])
}

model RegistrationWindow {
  id           String   @id @default(cuid())
  name         String
  type         String
  startDate    DateTime
  endDate      DateTime
  status       String   @default("UPCOMING")
  academicYear String
}

model DigitalCredential {
  id         String         @id @default(cuid())
  studentId  String
  type       String
  cardNumber String
  validUntil DateTime
  status     String         @default("ACTIVE")
  qrCode     String?
  createdAt  DateTime       @default(now())
  student    StudentProfile @relation(fields: [studentId], references: [id])
}

model ProgrammeMigration {
  id             String         @id @default(cuid())
  studentId      String
  type           String
  currentProgram String
  targetProgram  String
  reason         String
  status         String         @default("PENDING")
  appliedAt      DateTime       @default(now())
  student        StudentProfile @relation(fields: [studentId], references: [id])
}

model Communication {
  id            String    @id @default(cuid())
  type          String
  category      String?
  title         String
  content       String
  authorId      String?
  authorName    String
  targetId      String?
  date          DateTime  @default(now())
  expiryDate    DateTime?
  attachmentUrl String?
}

model CouncilAnnouncement {
  id         String   @id @default(cuid())
  title      String
  content    String
  date       DateTime @default(now())
  authorRole String
}

model PlacementDrive {
  id            String                 @id @default(cuid())
  companyName   String
  logoUrl       String?
  driveDate     DateTime
  jobTitle      String
  salaryPackage String?
  eligibility   String
  deadline      DateTime
  status        String                 @default("UPCOMING")
  applications  PlacementApplication[]
}

model CareerOpportunity {
  id            String   @id @default(cuid())
  type          String
  company       String
  title         String
  location      String
  stipend       String?
  description   String
  deadline      DateTime
  postedAt      DateTime @default(now())
  applyUrl      String?
  salaryPackage String?
}

model PlacementApplication {
  id        String         @id @default(cuid())
  studentId String
  driveId   String
  status    String         @default("APPLIED")
  appliedAt DateTime       @default(now())
  drive     PlacementDrive @relation(fields: [driveId], references: [id])
  student   StudentProfile @relation(fields: [studentId], references: [id])
}

model Club {
  id          String           @id @default(cuid())
  name        String
  description String
  category    String
  logoUrl     String?
  events      ClubEvent[]
  members     ClubMembership[]
}

model ClubMembership {
  id        String         @id @default(cuid())
  studentId String
  clubId    String
  role      String         @default("MEMBER")
  joinedAt  DateTime       @default(now())
  club      Club           @relation(fields: [clubId], references: [id])
  student   StudentProfile @relation(fields: [studentId], references: [id])
}

model ClubEvent {
  id          String   @id @default(cuid())
  clubId      String
  title       String
  description String
  date        DateTime
  location    String
  regLink     String?
  points      Int      @default(0)
  club        Club     @relation(fields: [clubId], references: [id])
}

model Achievement {
  id          String         @id @default(cuid())
  studentId   String
  title       String
  category    String
  description String
  date        DateTime
  documentUrl String?
  status      String         @default("PENDING")
  student     StudentProfile @relation(fields: [studentId], references: [id])
}

model ActivityPoint {
  id          String         @id @default(cuid())
  studentId   String
  type        String
  points      Int
  description String
  date        DateTime       @default(now())
  student     StudentProfile @relation(fields: [studentId], references: [id])
}

model FeedbackSurvey {
  id          String             @id @default(cuid())
  type        String
  title       String
  description String?
  status      String             @default("ACTIVE")
  responses   FeedbackResponse[]
}

model FeedbackResponse {
  id          String         @id @default(cuid())
  surveyId    String
  studentId   String
  courseId    String?
  facultyId   String?
  content     String
  submittedAt DateTime       @default(now())
  student     StudentProfile @relation(fields: [studentId], references: [id])
  survey      FeedbackSurvey @relation(fields: [surveyId], references: [id])
}

model ResearchProfile {
  id                String                @id @default(cuid())
  studentId         String                @unique
  supervisorId      String?
  researchArea      String?
  fellowshipStatus  String?
  publicationsCount Int                   @default(0)
  citations         Int                   @default(0)
  hIndex            Int                   @default(0)
  thesisStatus      String?
  documentUrl       String?
  progressReports   ProgressReport[]
  researchLetters   ResearchLetter[]
  supervisor        FacultyProfile?       @relation("Supervisor", fields: [supervisorId], references: [id])
  student           StudentProfile        @relation(fields: [studentId], references: [id])
  publications      ResearchPublication[]
}

model ResearchPublication {
  id                String          @id @default(cuid())
  researchProfileId String
  title             String
  journal           String
  year              Int
  doi               String?
  type              String          @default("JOURNAL")
  status            String          @default("PUBLISHED")
  authors           String?
  researchProfile   ResearchProfile @relation(fields: [researchProfileId], references: [id])
}

model ProgressReport {
  id                String          @id @default(cuid())
  researchProfileId String
  title             String
  content           String?
  fileUrl           String?
  status            String          @default("SUBMITTED")
  supervisorComment String?
  submittedAt       DateTime        @default(now())
  researchProfile   ResearchProfile @relation(fields: [researchProfileId], references: [id])
}

model ResearchLetter {
  id                String          @id @default(cuid())
  researchProfileId String
  title             String
  type              String
  url               String
  createdAt         DateTime        @default(now())
  researchProfile   ResearchProfile @relation(fields: [researchProfileId], references: [id])
}

model HostelAdmission {
  id        String         @id @default(cuid())
  studentId String
  type      String         @default("ADMISSION")
  status    String         @default("PENDING")
  block     String?
  roomPref  String?
  messPref  String?
  reason    String?
  appliedAt DateTime       @default(now())
  student   StudentProfile @relation(fields: [studentId], references: [id])
}

model HostelMaintenance {
  id        String         @id @default(cuid())
  studentId String
  block     String
  roomNo    String
  category  String
  issue     String
  status    String         @default("OPEN")
  createdAt DateTime       @default(now())
  student   StudentProfile @relation(fields: [studentId], references: [id])
}

model MessMenu {
  id        String   @id @default(cuid())
  messName  String
  day       String
  breakfast String?
  lunch     String?
  snacks    String?
  dinner    String?
  updatedAt DateTime @updatedAt
}

model HostelConsentForm {
  id        String         @id @default(cuid())
  studentId String
  type      String
  status    String         @default("PENDING")
  appliedAt DateTime       @default(now())
  url       String?
  student   StudentProfile @relation(fields: [studentId], references: [id])
}

model ThesisSubmission {
  id          String         @id @default(cuid())
  studentId   String         @unique
  title       String
  abstract    String
  status      String         @default("SUBMITTED")
  submittedAt DateTime       @default(now())
  student     StudentProfile @relation(fields: [studentId], references: [id])
}

model ExamSchedule {
  id              String           @id @default(cuid())
  courseId        String?
  courseCode      String
  courseTitle     String
  examDate        DateTime
  slot            String
  venue           String
  mode            String           @default("OFFLINE")
  type            String
  course          Course?          @relation(fields: [courseId], references: [id])
  seatAllocations SeatAllocation[]
}

model SeatAllocation {
  id             String         @id @default(cuid())
  examScheduleId String
  studentId      String
  roomNo         String
  seatNo         String
  createdAt      DateTime       @default(now())
  student        StudentProfile @relation(fields: [studentId], references: [id])
  examSchedule   ExamSchedule   @relation(fields: [examScheduleId], references: [id])

  @@unique([examScheduleId, studentId])
}

model ExamApplication {
  id        String         @id @default(cuid())
  studentId String
  type      String
  status    String         @default("APPLIED")
  appliedAt DateTime       @default(now())
  student   StudentProfile @relation(fields: [studentId], references: [id])
}

model BiometricReport {
  id        String         @id @default(cuid())
  studentId String
  date      DateTime
  checkIn   DateTime?
  checkOut  DateTime?
  status    String
  student   StudentProfile @relation(fields: [studentId], references: [id])
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  title     String
  message   String
  type      String   @default("INFO")
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
}

model Message {
  id         String   @id @default(cuid())
  senderId   String
  receiverId String
  subject    String?
  content    String
  createdAt  DateTime @default(now())
  receiver   User     @relation("ReceivedMessages", fields: [receiverId], references: [id])
  sender     User     @relation("SentMessages", fields: [senderId], references: [id])
}

model Meeting {
  id        String         @id @default(cuid())
  studentId String
  facultyId String
  title     String
  date      DateTime
  time      String
  venue     String
  status    String         @default("SCHEDULED")
  notes     String?
  createdAt DateTime       @default(now())
  faculty   FacultyProfile @relation(fields: [facultyId], references: [id])
  student   StudentProfile @relation(fields: [studentId], references: [id])
}

model CounsellingRecord {
  id          String         @id @default(cuid())
  studentId   String
  facultyId   String
  date        DateTime
  summary     String
  actionTaken String?
  priority    String         @default("NORMAL")
  createdAt   DateTime       @default(now())
  faculty     FacultyProfile @relation(fields: [facultyId], references: [id])
  student     StudentProfile @relation(fields: [studentId], references: [id])
}

model Assignment {
  id          String                 @id @default(cuid())
  courseId    String
  title       String
  description String?
  dueDate     DateTime
  fileUrl     String?
  createdAt   DateTime               @default(now())
  course      Course                 @relation(fields: [courseId], references: [id])
  submissions AssignmentSubmission[]
}

model AssignmentSubmission {
  id               String          @id @default(cuid())
  assignmentId     String
  studentId        String
  fileUrl          String?
  status           String          @default("SUBMITTED")
  grade            String?
  feedback         String?
  submittedAt      DateTime        @default(now())
  facultyProfileId String?
  facultyProfile   FacultyProfile? @relation(fields: [facultyProfileId], references: [id])
  student          StudentProfile  @relation(fields: [studentId], references: [id])
  assignment       Assignment      @relation(fields: [assignmentId], references: [id])
}

model CourseAnnouncement {
  id        String   @id @default(cuid())
  courseId  String
  title     String
  content   String
  createdAt DateTime @default(now())
  course    Course   @relation(fields: [courseId], references: [id])
}

model ForumPost {
  id        String       @id @default(cuid())
  courseId  String
  authorId  String
  title     String
  content   String
  createdAt DateTime     @default(now())
  author    User         @relation(fields: [authorId], references: [id])
  course    Course       @relation(fields: [courseId], references: [id])
  replies   ForumReply[]
}

model ForumReply {
  id        String    @id @default(cuid())
  postId    String
  authorId  String
  content   String
  createdAt DateTime  @default(now())
  author    User      @relation(fields: [authorId], references: [id])
  post      ForumPost @relation(fields: [postId], references: [id])
}

model Book {
  id              String            @id @default(cuid())
  isbn            String            @unique
  title           String
  author          String
  category        String
  totalCopies     Int
  availableCopies Int
  location        String
  issues          BookIssue[]
  reservations    BookReservation[]
}

model BookIssue {
  id         String         @id @default(cuid())
  studentId  String
  bookId     String
  issueDate  DateTime       @default(now())
  dueDate    DateTime
  returnDate DateTime?
  status     String         @default("ISSUED")
  book       Book           @relation(fields: [bookId], references: [id])
  student    StudentProfile @relation(fields: [studentId], references: [id])
}

model BookReservation {
  id              String         @id @default(cuid())
  studentId       String
  bookId          String
  reservationDate DateTime       @default(now())
  status          String         @default("PENDING")
  book            Book           @relation(fields: [bookId], references: [id])
  student         StudentProfile @relation(fields: [studentId], references: [id])
}

model LibraryDue {
  id        String         @id @default(cuid())
  studentId String
  amount    Float
  reason    String
  status    String         @default("UNPAID")
  student   StudentProfile @relation(fields: [studentId], references: [id])
}

model EResource {
  id       String @id @default(cuid())
  title    String
  type     String
  url      String
  category String
}

model ParentAnnouncement {
  id       String         @id @default(cuid())
  parentId String?
  title    String
  content  String
  date     DateTime       @default(now())
  priority String         @default("NORMAL")
  parent   ParentProfile? @relation(fields: [parentId], references: [id])
}

model Payroll {
  id          String         @id @default(cuid())
  facultyId   String
  month       String
  year        String
  basePay     Float
  allowances  Float
  deductions  Float
  netPay      Float
  status      String         @default("PROCESSED")
  slipUrl     String?
  processedAt DateTime       @default(now())
  faculty     FacultyProfile @relation(fields: [facultyId], references: [id])
}

model FacultyLeave {
  id        String         @id @default(cuid())
  facultyId String
  type      String
  fromDate  DateTime
  toDate    DateTime
  reason    String
  status    String         @default("PENDING")
  createdAt DateTime       @default(now())
  faculty   FacultyProfile @relation(fields: [facultyId], references: [id])
}

model SecurityAudit {
  id        String   @id @default(cuid())
  userId    String
  event     String
  ipAddress String?
  device    String?
  timestamp DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
}
